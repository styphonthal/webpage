<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Projects - CommandBridge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0a1120" />
  <style>
    :root{
      --bg:#050911;
      --panel:#0a1120;
      --text:#f8fafc;
      --muted:#94a3b8;
      --accent:#3b82f6;
      --accent-bright:#60a5fa;
      --border:#1e293b;
      --radius:16px;
      --shadow:0 20px 60px rgba(0,0,0,.4);

      /* status colors */
      --status-active:#22c55e;
      --status-near:#eab308;
      --status-stalled:#f97316;
      --status-complete:#22c55e;
      --status-default:#64748b;
    }
    
    *{box-sizing:border-box; margin:0; padding:0}
    html,body{height:100%; overflow-x:hidden}
    
    body{
      background:
        radial-gradient(ellipse 1400px 800px at 20% -15%, rgba(59,130,246,.08), transparent 60%),
        radial-gradient(ellipse 1200px 700px at 80% 25%, rgba(96,165,250,.06), transparent 65%),
        var(--bg);
      color:var(--text);
      font:16px/1.6 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
    }

    .sidebar{
      position:fixed;
      inset:0 auto 0 0;
      width:260px;
      background:linear-gradient(180deg, rgba(10,17,32,.85), rgba(13,20,34,.90));
      backdrop-filter:blur(20px);
      -webkit-backdrop-filter:blur(20px);
      border-right:1px solid var(--border);
      padding:32px 24px;
      z-index:100;
      box-shadow:4px 0 24px rgba(0,0,0,.3);
    }
    
    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      margin-bottom:40px;
      padding-bottom:24px;
      border-bottom:1px solid rgba(59,130,246,.15);
    }

    .badge {
      width:42px;
      height:42px;
      border-radius:10px;
      background:url("../command.png") center/cover no-repeat,
                 linear-gradient(135deg, var(--accent), #2563eb);
      box-shadow:0 8px 24px rgba(59,130,246,.4), 0 0 60px rgba(59,130,246,.2);
      animation:pulse-glow 4s ease-in-out infinite;
    }
    
    @keyframes pulse-glow{
      0%, 100%{box-shadow:0 8px 24px rgba(59,130,246,.4), 0 0 60px rgba(59,130,246,.2)}
      50%{box-shadow:0 8px 32px rgba(59,130,246,.5), 0 0 80px rgba(59,130,246,.3)}
    }
    
    .brand h1{
      font-size:20px;
      font-weight:700;
      letter-spacing:.5px;
      background:linear-gradient(135deg, #60a5fa, #3b82f6);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    
    nav a{
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px 16px;
      margin:8px 0;
      text-decoration:none;
      color:var(--muted);
      border-radius:12px;
      transition:all .25s cubic-bezier(.4,0,.2,1);
      border:1px solid transparent;
      font-weight:500;
      position:relative;
      overflow:hidden;
    }
    
    nav a::before{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(135deg, rgba(59,130,246,.1), rgba(96,165,250,.08));
      opacity:0;
      transition:opacity .25s;
    }
    
    nav a:hover{
      color:var(--text);
      border-color:rgba(59,130,246,.3);
      transform:translateX(4px);
    }
    
    nav a:hover::before{opacity:1}
    
    nav a.active{
      color:var(--accent-bright);
      background:linear-gradient(135deg, rgba(59,130,246,.15), rgba(96,165,250,.12));
      border-color:rgba(59,130,246,.4);
      box-shadow:0 4px 12px rgba(59,130,246,.15);
    }
    
    .nav-dot{
      width:6px;
      height:6px;
      border-radius:50%;
      background:currentColor;
      transition:all .25s;
    }
    
    nav a.active .nav-dot{
      width:8px;
      height:8px;
      box-shadow:0 0 12px currentColor;
    }

    .main{
      margin-left:260px;
      padding:40px 48px 80px;
      max-width:1600px;
    }

    .header{
      margin-bottom:32px;
      animation:fade-in-up 1s ease-out;
    }

    @keyframes fade-in-up{
      from{opacity:0; transform:translateY(20px)}
      to{opacity:1; transform:translateY(0)}
    }

    .header h2{
      font-size:36px;
      font-weight:900;
      margin:0 0 8px 0;
      background:linear-gradient(135deg, #f8fafc, #cbd5e1);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }

    .header-desc{
      color:var(--muted);
      font-size:15px;
    }

    .controls{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin:24px 0;
      animation:fade-in-up 1s ease-out .1s both;
    }

    .input, .select{
      background:rgba(15,23,42,.7);
      color:var(--text);
      border:1px solid rgba(59,130,246,.2);
      border-radius:12px;
      padding:12px 16px;
      outline:none;
      transition:all .25s;
      font-size:14px;
    }

    .input:focus, .select:focus{
      border-color:rgba(59,130,246,.5);
      box-shadow:0 0 0 3px rgba(59,130,246,.15);
      background:rgba(15,23,42,.9);
    }

    .input{min-width:300px; flex:1}
    .select{min-width:160px}

    .tags{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin:20px 0;
      animation:fade-in-up 1s ease-out .2s both;
    }

    .chip{
      background:rgba(15,23,42,.6);
      border:1px solid rgba(59,130,246,.2);
      color:var(--muted);
      padding:8px 16px;
      border-radius:999px;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      transition:all .25s;
      user-select:none;
    }

    .chip:hover{
      border-color:rgba(59,130,246,.4);
      color:var(--text);
      transform:translateY(-2px);
    }

    .chip.active{
      background:rgba(59,130,246,.18);
      color:var(--accent-bright);
      border-color:rgba(59,130,246,.5);
      box-shadow:0 4px 12px rgba(59,130,246,.2);
    }

    .card-grid{
      display:grid;
      gap:24px;
      grid-template-columns:repeat(auto-fill, minmax(340px,1fr));
      animation:fade-in-up 1s ease-out .3s both;
    }

    .card{
      background:linear-gradient(145deg, rgba(15,23,42,.8), rgba(10,17,32,.9));
      border:1px solid rgba(59,130,246,.25);
      border-radius:var(--radius);
      padding:20px 20px 20px;
      box-shadow:0 10px 40px rgba(0,0,0,.3);
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:180px;
      transition:all .4s cubic-bezier(.4,0,.2,1);
      position:relative;
      overflow:hidden;
      cursor:pointer;
    }

    .card::before{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(135deg, rgba(59,130,246,.12), transparent);
      opacity:0;
      transition:opacity .4s;
    }

    .card:hover{
      transform:translateY(-6px);
      border-color:rgba(59,130,246,.5);
      box-shadow:0 25px 70px rgba(0,0,0,.5), 0 0 60px rgba(59,130,246,.2);
    }

    .card:hover::before{opacity:1}

    .card-thumb{
      border-radius:12px;
      overflow:hidden;
      margin-bottom:10px;
      border:1px solid rgba(15,23,42,.8);
      background:radial-gradient(circle at top, rgba(148,163,184,.25), transparent);
    }

    .card-thumb img{
      display:block;
      width:100%;
      height:160px;
      object-fit:cover;
    }

    .card-header-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }

    .card-title{
      font-size:18px;
      font-weight:800;
      position:relative;
      z-index:1;
      background:linear-gradient(135deg, #f8fafc, #cbd5e1);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      line-height:1.3;
    }

    .status-pill{
      padding:4px 10px;
      border-radius:999px;
      font-size:11px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.08em;
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }

    .status-dot{
      width:7px;
      height:7px;
      border-radius:999px;
      background:currentColor;
      box-shadow:0 0 8px currentColor;
    }

    .card-desc{
      color:var(--muted);
      line-height:1.6;
      position:relative;
      z-index:1;
      font-size:14px;
      flex:1;
    }

    .card-progress{
      margin-top:4px;
    }

    .card-progress-bar{
      position:relative;
      width:100%;
      height:6px;
      background:rgba(15,23,42,.9);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,1);
    }

    .card-progress-fill{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, #22c55e, #3b82f6);
      border-radius:inherit;
      transition:width .4s ease-out;
    }

    .card-progress-label{
      margin-top:4px;
      font-size:11px;
      color:var(--muted);
    }

    .card-meta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top:auto;
      position:relative;
      z-index:1;
      gap:12px;
      flex-wrap:wrap;
    }

    .card-tags{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }

    .tag-pill{
      padding:4px 10px;
      border:1px solid rgba(59,130,246,.3);
      border-radius:999px;
      font-size:11px;
      color:var(--accent-bright);
      font-weight:600;
      background:rgba(59,130,246,.1);
    }

    .card-date{
      color:var(--muted);
      font-size:13px;
      white-space:nowrap;
    }

    .empty{
      border:1px dashed var(--border);
      background:rgba(15,23,42,.5);
      border-radius:var(--radius);
      padding:40px;
      color:var(--muted);
      text-align:center;
      font-size:15px;
    }

    /* Modal */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.85);
      backdrop-filter:blur(8px);
      -webkit-backdrop-filter:blur(8px);
      z-index:1000;
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      animation:fade-in .3s ease-out;
    }

    @keyframes fade-in{
      from{opacity:0}
      to{opacity:1}
    }

    .modal.active{display:flex}

    .modal-content{
      background:linear-gradient(145deg, rgba(15,23,42,.95), rgba(10,17,32,.95));
      border:1px solid rgba(59,130,246,.3);
      border-radius:20px;
      max-width:900px;
      width:100%;
      max-height:90vh;
      overflow-y:auto;
      box-shadow:0 30px 90px rgba(0,0,0,.6), 0 0 80px rgba(59,130,246,.2);
      animation:slide-up .4s ease-out;
      position:relative;
    }

    @keyframes slide-up{
      from{opacity:0; transform:translateY(40px)}
      to{opacity:1; transform:translateY(0)}
    }

    .modal-header{
      padding:32px 32px 24px;
      border-bottom:1px solid rgba(59,130,246,.2);
    }

    .modal-title{
      font-size:28px;
      font-weight:900;
      background:linear-gradient(135deg, #f8fafc, #60a5fa);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      margin-bottom:12px;
      line-height:1.2;
    }

    .modal-desc{
      color:var(--muted);
      line-height:1.7;
      font-size:15px;
    }

    .modal-body{
      padding:24px 32px 32px;
    }

    .info-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
      gap:20px;
      margin-bottom:28px;
    }

    .info-item{
      background:rgba(59,130,246,.08);
      border:1px solid rgba(59,130,246,.2);
      border-radius:12px;
      padding:16px;
    }

    .info-label{
      font-size:11px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:1px;
      font-weight:700;
      margin-bottom:6px;
    }

    .info-value{
      font-size:18px;
      font-weight:800;
      color:var(--accent-bright);
    }

    .info-value-small{
      font-size:13px;
      font-weight:500;
      color:var(--muted);
      margin-top:4px;
    }

    .section-title{
      font-size:14px;
      color:var(--accent-bright);
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:1.5px;
      margin:28px 0 16px;
      padding-left:16px;
      position:relative;
    }

    .section-title::before{
      content:'';
      position:absolute;
      left:0;
      top:50%;
      transform:translateY(-50%);
      width:6px;
      height:6px;
      background:var(--accent-bright);
      border-radius:50%;
      box-shadow:0 0 10px var(--accent-bright);
    }

    .section-sub{
      font-size:13px;
      color:var(--muted);
      margin:0 0 8px 0;
    }

    .list-bullets{
      margin:0;
      padding-left:18px;
      color:var(--muted);
      font-size:14px;
      line-height:1.6;
    }

    .list-bullets li{
      margin-bottom:4px;
    }

    .changelog{
      display:grid;
      gap:12px;
    }

    .changelog-item{
      background:rgba(15,23,42,.6);
      border:1px solid rgba(59,130,246,.15);
      border-radius:10px;
      padding:14px 16px;
      line-height:1.6;
      color:var(--muted);
      font-size:14px;
    }

    .changelog-date{
      color:var(--accent-bright);
      font-weight:700;
      margin-right:12px;
    }

    .tech-stack{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .tech-badge{
      background:rgba(59,130,246,.12);
      border:1px solid rgba(59,130,246,.3);
      color:var(--accent-bright);
      padding:8px 14px;
      border-radius:8px;
      font-size:13px;
      font-weight:600;
    }

    .links-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:8px;
    }

    .link-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:8px 14px;
      border-radius:999px;
      border:1px solid rgba(59,130,246,.4);
      background:rgba(15,23,42,.9);
      color:var(--accent-bright);
      font-size:13px;
      font-weight:600;
      text-decoration:none;
      transition:all .25s;
    }

    .link-pill:hover{
      background:rgba(59,130,246,.2);
      transform:translateY(-1px);
    }

    .gallery{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(200px,1fr));
      gap:12px;
    }

    .gallery img{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.9);
      object-fit:cover;
      max-height:220px;
    }

    .gallery-empty{
      font-size:13px;
      color:var(--muted);
    }

    .close-btn{
      position:absolute;
      top:24px;
      right:24px;
      width:40px;
      height:40px;
      border-radius:50%;
      background:rgba(59,130,246,.15);
      border:1px solid rgba(59,130,246,.3);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:all .25s;
      font-size:20px;
      z-index:10;
    }

    .close-btn:hover{
      background:rgba(59,130,246,.25);
      border-color:rgba(59,130,246,.5);
      transform:rotate(90deg);
    }

    @media (max-width:1024px){
      .sidebar{width:240px}
      .main{margin-left:240px; padding:32px}
    }

    @media (max-width:768px){
      .sidebar{
        width:100%;
        position:relative;
        padding:20px;
        border-right:none;
        border-bottom:1px solid var(--border);
      }
      .main{margin-left:0; padding:20px 16px}
      .header h2{font-size:28px}
      .input{min-width:100%}
      .card-grid{grid-template-columns:1fr}
      .modal-content{max-height:95vh}
      .modal-header{padding:24px 20px 20px}
      .modal-body{padding:20px}
      .info-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <div class="badge"></div>
      <h1>CommandBridge</h1>
    </div>
    <nav>
      <a href="../index.html"><span class="nav-dot"></span> Home</a>
      <a href="./index.html" class="active"><span class="nav-dot"></span> Projects</a>
      <a href="../widgets/index.html"><span class="nav-dot"></span> Widgets</a>
    </nav>
  </aside>

  <main class="main">
    <div class="header">
      <h2>Projects</h2>
      <div class="header-desc">Experimental builds and automation pipelines</div>
    </div>

    <div class="controls">
      <input id="q" class="input" type="search" placeholder="Search projects..." />
      <select id="sort" class="select">
        <option value="updated-desc">Recently Updated</option>
        <option value="updated-asc">Oldest First</option>
        <option value="title-asc">A → Z</option>
        <option value="title-desc">Z → A</option>
      </select>
    </div>

    <div id="tagRow" class="tags"></div>

    <div id="grid" class="card-grid"></div>
    <div id="empty" class="empty" style="display:none">No matching projects found.</div>
  </main>

  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="close-btn" id="closeModal">×</div>
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle"></h3>
        <p class="modal-desc" id="modalDesc"></p>
      </div>
      <div class="modal-body">
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">Status</div>
            <div class="info-value" id="modalStatus"></div>
            <div class="info-value-small" id="modalStatusHint"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Started</div>
            <div class="info-value" id="modalStarted"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Last Updated</div>
            <div class="info-value" id="modalUpdated"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Completion</div>
            <div class="info-value" id="modalPercent"></div>
            <div class="info-value-small" id="modalPercentHint"></div>
          </div>
        </div>

        <div class="section-title">Technologies</div>
        <div class="tech-stack" id="modalTech"></div>

        <div class="section-title">Best for</div>
        <p class="section-sub" id="modalBestFor"></p>

        <div class="section-title">What I learned</div>
        <ul class="list-bullets" id="modalLearned"></ul>

        <div class="section-title">Future plans</div>
        <ul class="list-bullets" id="modalFuture"></ul>

        <div class="section-title">Status for contributors</div>
        <p class="section-sub" id="modalContribStatus"></p>

        <div class="section-title">Links</div>
        <div class="links-row" id="modalLinks"></div>

        <div class="section-title">Screenshots</div>
        <div class="gallery" id="modalGallery"></div>

        <div class="section-title">Changelog</div>
        <div class="changelog" id="modalChangelog"></div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const state = {
      all: [],
      filtered: [],
      tags: new Set(),
      activeTags: new Set(),
      q: '',
      sort: 'updated-desc'
    };

    const el = {
      q: document.getElementById('q'),
      sort: document.getElementById('sort'),
      tagRow: document.getElementById('tagRow'),
      grid: document.getElementById('grid'),
      empty: document.getElementById('empty'),
      modal: document.getElementById('modal'),
      closeModal: document.getElementById('closeModal')
    };

    function normalize(p){
      return {
        id: String(p.id || Math.random().toString(36).slice(2,10)),
        title: String(p.title || 'Untitled'),
        description: String(p.description || ''),
        tags: Array.isArray(p.tags) ? p.tags.map(String) : [],
        updated: parseDate(p.updated),
        started: parseDate(p.started || p.updated),
        status: String(p.status || 'Active'),
        changelog: Array.isArray(p.changelog) ? p.changelog : [],
        tech: Array.isArray(p.tech) ? p.tech : p.tags || [],
        percentComplete: typeof p.percentComplete === 'number' ? p.percentComplete : 0,
        github: p.github ? String(p.github) : '',
        images: Array.isArray(p.images) ? p.images : [],
        whatILearned: Array.isArray(p.whatILearned) ? p.whatILearned : [],
        bestFor: p.bestFor ? String(p.bestFor) : '',
        futurePlans: Array.isArray(p.futurePlans) ? p.futurePlans : [],
        statusForContributors: p.statusForContributors ? String(p.statusForContributors) : '',
        featureToggle: typeof p.featureToggle === 'object' && p.featureToggle !== null
          ? {
              featured: Boolean(p.featureToggle.featured),
              reason: p.featureToggle.reason ? String(p.featureToggle.reason) : ''
            }
          : { featured:false, reason:'' },
        _search: (String(p.title) + ' ' + String(p.description) + ' ' + (Array.isArray(p.tags) ? p.tags.join(' ') : '')).toLowerCase()
      };
    }

    function parseDate(d){
      if(!d) return Date.now();
      const t = Date.parse(d);
      return Number.isFinite(t) ? t : Date.now();
    }

    async function fetchJSON(url){
      const res = await fetch(url, {cache:'no-store'});
      if(!res.ok) throw new Error('Failed: '+res.status);
      return res.json();
    }

    function renderTags(){
      el.tagRow.innerHTML = '';
      const allTags = Array.from(state.tags).sort();
      if(!allTags.length) return;
      
      const allChip = chip('All', !state.activeTags.size);
      allChip.onclick = ()=>{ state.activeTags.clear(); renderTags(); applyFilters(); };
      el.tagRow.appendChild(allChip);

      for(const t of allTags){
        const c = chip(t, state.activeTags.has(t));
        c.onclick = ()=>{
          state.activeTags.has(t) ? state.activeTags.delete(t) : state.activeTags.add(t);
          renderTags(); applyFilters();
        };
        el.tagRow.appendChild(c);
      }
    }

    function chip(label, active){
      const d = document.createElement('div');
      d.className = 'chip'+(active?' active':'');
      d.textContent = label;
      return d;
    }

    function applyFilters(){
      const q = state.q.trim().toLowerCase();
      let arr = state.all.filter(p=>{
        const okQ = q ? p._search.includes(q) : true;
        const okT = state.activeTags.size ? p.tags.some(t=>state.activeTags.has(t)) : true;
        return okQ && okT;
      });

      const s = state.sort;
      if(s === 'updated-desc') arr.sort((a,b)=>b.updated - a.updated);
      else if(s === 'updated-asc') arr.sort((a,b)=>a.updated - b.updated);
      else if(s === 'title-asc') arr.sort((a,b)=>a.title.localeCompare(b.title));
      else if(s === 'title-desc') arr.sort((a,b)=>b.title.localeCompare(a.title));

      state.filtered = arr;
      renderGrid();
    }

    function fmtDate(ts){
      if(!ts) return 'N/A';
      const d = new Date(ts);
      return d.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
    }

    function statusStyles(status){
      const s = status.toLowerCase();
      if(s.includes('complete') && s.includes('beta')) return {label: 'Complete (Beta)', color:'var(--status-complete)'};
      if(s.includes('near')) return {label: 'Near Complete', color:'var(--status-near)'};
      if(s.includes('stall')) return {label: 'Stalled', color:'var(--status-stalled)'};
      if(s.includes('complete')) return {label: 'Complete', color:'var(--status-complete)'};
      if(s.includes('active')) return {label: 'Active', color:'var(--status-active)'};
      return {label: status, color:'var(--status-default)'};
    }

    function percentHint(p){
      if(p >= 95) return 'Ready for everyday use with minor polish ongoing.';
      if(p >= 80) return 'Feature complete, polishing and stability work in progress.';
      if(p >= 50) return 'Core functionality present; active development.';
      if(p > 0) return 'Early prototype phase.';
      return 'Not started or concept only.';
    }

    function renderGrid(){
      el.grid.innerHTML = '';
      if(!state.filtered.length){
        el.empty.style.display='block';
        return;
      }
      el.empty.style.display='none';

      for(const p of state.filtered){
        const card = document.createElement('article');
        card.className = 'card';
        card.onclick = ()=>showModal(p);
        
        const tags = p.tags.map(t=>`<span class="tag-pill">${esc(t)}</span>`).join('');
        const thumb = p.images && p.images.length
          ? `<div class="card-thumb"><img src="${esc(p.images[0])}" alt="${esc(p.title)} screenshot"></div>`
          : '';

        const status = statusStyles(p.status);
        const percent = Math.max(0, Math.min(100, p.percentComplete || 0));

        card.innerHTML = `
          ${thumb}
          <div class="card-header-row">
            <div class="card-title">${esc(p.title)}</div>
            <div class="status-pill" style="color:${status.color}; border:1px solid ${status.color}33; background:rgba(15,23,42,.9);">
              <span class="status-dot"></span>
              <span>${esc(status.label)}</span>
            </div>
          </div>
          <div class="card-desc">${esc(p.description)}</div>
          <div class="card-progress">
            <div class="card-progress-bar">
              <div class="card-progress-fill" style="width:${percent}%;"></div>
            </div>
            <div class="card-progress-label">${percent}% complete</div>
          </div>
          <div class="card-meta">
            <div class="card-tags">${tags}</div>
            <div class="card-date">${fmtDate(p.updated)}</div>
          </div>
        `;
        el.grid.appendChild(card);
      }
    }

    function showModal(p){
      const status = statusStyles(p.status);
      const percent = Math.max(0, Math.min(100, p.percentComplete || 0));

      document.getElementById('modalTitle').textContent = p.title;
      document.getElementById('modalDesc').textContent = p.description;
      document.getElementById('modalStatus').textContent = status.label;
      document.getElementById('modalStatus').style.color = status.color;
      document.getElementById('modalStarted').textContent = fmtDate(p.started);
      document.getElementById('modalUpdated').textContent = fmtDate(p.updated);
      document.getElementById('modalPercent').textContent = percent + '%';
      document.getElementById('modalPercent').style.color = percent >= 80 ? 'var(--status-active)' : 'var(--accent-bright)';
      document.getElementById('modalStatusHint').textContent = p.status;
      document.getElementById('modalPercentHint').textContent = percentHint(percent);
      
      const techEl = document.getElementById('modalTech');
      techEl.innerHTML = p.tech.map(t=>`<span class="tech-badge">${esc(t)}</span>`).join('');

      const bestForEl = document.getElementById('modalBestFor');
      bestForEl.textContent = p.bestFor || 'Not specified yet.';

      const learnedEl = document.getElementById('modalLearned');
      if(p.whatILearned && p.whatILearned.length){
        learnedEl.innerHTML = p.whatILearned.map(item => `<li>${esc(item)}</li>`).join('');
      } else {
        learnedEl.innerHTML = '<li>No notes added yet.</li>';
      }

      const futureEl = document.getElementById('modalFuture');
      if(p.futurePlans && p.futurePlans.length){
        futureEl.innerHTML = p.futurePlans.map(item => `<li>${esc(item)}</li>`).join('');
      } else {
        futureEl.innerHTML = '<li>No future roadmap documented yet.</li>';
      }

      const contribEl = document.getElementById('modalContribStatus');
      contribEl.textContent = p.statusForContributors || 'No contributor status set yet.';
      
      const linksEl = document.getElementById('modalLinks');
      if(p.github){
        linksEl.innerHTML = `
          <a class="link-pill" href="${esc(p.github)}" target="_blank" rel="noopener noreferrer">
            <span>GitHub Repo</span>
          </a>
        `;
      }else{
        linksEl.innerHTML = '<span style="color:var(--muted); font-size:13px;">No public repository linked yet.</span>';
      }

      const galleryEl = document.getElementById('modalGallery');
      if(p.images && p.images.length){
        galleryEl.innerHTML = p.images.map(src=>`
          <img src="${esc(src)}" alt="${esc(p.title)} screenshot">
        `).join('');
      }else{
        galleryEl.innerHTML = '<div class="gallery-empty">No screenshots added yet.</div>';
      }
      
      const changelogEl = document.getElementById('modalChangelog');
      if(p.changelog.length){
        changelogEl.innerHTML = p.changelog.map(c=>`
          <div class="changelog-item">
            <span class="changelog-date">${esc(c.date || 'TBD')}</span>
            ${esc(c.note || c)}
          </div>
        `).join('');
      } else {
        changelogEl.innerHTML = '<div class="changelog-item">No changelog available yet.</div>';
      }
      
      el.modal.classList.add('active');
    }

    function closeModal(){
      el.modal.classList.remove('active');
    }

    function esc(s){
      return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]));
    }

    async function init(){
      let data = [];
      try{
        data = await fetchJSON('../data/projects.json');
      }catch(e){
        console.error(e);
      }
      state.all = (Array.isArray(data) ? data : []).map(normalize);

      state.tags.clear();
      for(const p of state.all){
        for(const t of p.tags) state.tags.add(t);
      }
      renderTags();
      applyFilters();
    }

    el.q.addEventListener('input', e=>{ state.q = e.target.value; applyFilters(); });
    el.sort.addEventListener('change', e=>{ state.sort = e.target.value; applyFilters(); });
    el.closeModal.addEventListener('click', closeModal);
    el.modal.addEventListener('click', e=>{ if(e.target === el.modal) closeModal(); });
    document.addEventListener('keydown', e=>{ if(e.key === 'Escape') closeModal(); });

    init();
  })();
  </script>
</body>
</html>
