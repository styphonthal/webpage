<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Sabres Score Widget</title>
<meta name="viewport" content="width=480, initial-scale=1">
<style>
  :root {
    --bg:#0b0f14;
    --panel:#0f1722;
    --text:#e5e7eb;
    --muted:#94a3b8;
    --accent:#60a5fa;
    --border:#1f2937;
  }
  body {
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:system-ui, sans-serif;
    width:480px;
    height:320px;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .box {
    width:460px;
    height:300px;
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:14px;
    padding:18px;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
  }

  h2 {
    margin:0;
    font-size:1.45rem;
    color:var(--accent);
    text-align:center;
  }

  .row {
    margin-top:10px;
    font-size:1.25rem;
    text-align:center;
  }

  .small {
    font-size:0.9rem;
    color:var(--muted);
    text-align:center;
  }

  .updating {
    font-size:0.75rem;
    color:var(--muted);
    text-align:center;
    margin-top:4px;
  }
</style>
</head>
<body>

<div class="box">
  <h2>Buffalo Sabres</h2>

  <div id="status" class="row">Loading…</div>
  <div id="extra" class="small"></div>

  <div class="updating">Auto-refreshing every 60s</div>
</div>

<script>
async function loadScore() {
  const statusEl = document.getElementById('status');
  const extraEl = document.getElementById('extra');

  try {
    // ESPN NHL Scoreboard
    const url = "https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard";
    const data = await fetch(url, {cache:"no-store"}).then(r => r.json());

    const events = data.events || [];

    // Find any Sabres game (live, final, or scheduled)
    const game = events.find(ev =>
      ev.competitions?.[0]?.competitors?.some(c => c.team?.shortDisplayName === "BUF")
    );

    if (!game) {
      statusEl.textContent = "No game today";
      extraEl.textContent = "";
      return;
    }

    const comp = game.competitions[0];
    const teams = comp.competitors;

    const buffalo = teams.find(t => t.team.shortDisplayName === "BUF");
    const other = teams.find(t => t.team.shortDisplayName !== "BUF");

    const buffaloScore = buffalo.score || "0";
    const otherScore = other.score || "0";

    const homeAway = buffalo.homeAway === "home" ? "(Home)" : "(Away)";
    const oppName = other.team.shortDisplayName;

    const statusType = comp.status.type.name;
    const detail = comp.status.type.detail || "";
    const shortDetail = comp.status.type.shortDetail || "";

    if (statusType === "STATUS_IN_PROGRESS") {
      statusEl.innerHTML = `${buffaloScore}–${otherScore} vs ${oppName}<br><span style="font-size:1rem">${shortDetail}</span>`;
      extraEl.textContent = detail;
    } else if (statusType === "STATUS_FINAL") {
      statusEl.innerHTML = `Final: ${buffaloScore}–${otherScore} vs ${oppName}`;
      extraEl.textContent = detail;
    } else if (statusType === "STATUS_SCHEDULED") {
      statusEl.innerHTML = `Next: vs ${oppName}`;
      extraEl.textContent = shortDetail;
    } else {
      statusEl.textContent = shortDetail || "Game status unknown";
      extraEl.textContent = detail;
    }

  } catch (err) {
    statusEl.textContent = "Error loading data";
    extraEl.textContent = "";
    console.error(err);
  }
}

// First load
loadScore();
// Refresh every 60s
setInterval(loadScore, 60000);
</script>

</body>
</html>
