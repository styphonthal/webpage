<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Buffalo Sabres — Scores & Goals v2 </title>
<style>
  :root{
    --sabres-navy: #002654;
    --sabres-gold: #FCB514;
    --sabres-white: #f7f9fc;
    --bg-deep: #001631;
  }
  *{box-sizing:border-box; margin:0; padding:0}
  html,body{height:100%; min-height:100vh}
  body{
    color:var(--sabres-white);
    background:
      radial-gradient(1200px 700px at 80% 10%, rgba(252,181,20,.12), transparent 60%),
      radial-gradient(900px 500px at 20% 80%, rgba(0,38,84,.35), transparent 70%),
      var(--bg-deep);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
  }
  
  .wrap{
    max-width:1200px;
    width:100%;
    margin:0 auto;
    padding:28px clamp(16px, 3vw, 36px);
  }

  /* Score header */
  .scorebar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:18px;
    flex-wrap:wrap;
    background: linear-gradient(180deg, rgba(0,38,84,.85), rgba(0,28,62,.85));
    border: 2px solid rgba(252,181,20,.35);
    border-radius:18px;
    padding:18px 20px;
    box-shadow: 0 12px 30px rgba(0,0,0,.35);
  }
  
  .teams{
    display:grid;
    grid-template-columns: 1fr auto 1fr;
    align-items:center;
    gap:16px;
    flex:1 1 auto;
    min-width:0;
  }
  
  .team{
    display:flex;
    align-items:center;
    gap:12px;
    min-width:0;
  }
  
  .team.away{justify-content:flex-end}
  .team.home{justify-content:flex-start}
  
  .badge{
    width:50px;
    height:50px;
    border-radius:10px;
    background-size:cover;
    background-position:center;
    border:2px solid rgba(252,181,20,.3);
    flex-shrink:0;
  }
  
  .name{
    font-weight:700;
    letter-spacing:.3px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    font-size:1.1rem;
  }
  
  .score{
    font-weight:800;
    font-size:2.4rem;
    padding:0 12px;
    color:var(--sabres-gold);
    white-space:nowrap;
  }
  
  .meta{
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:6px;
    min-width:160px;
    color:#cfe1ff;
  }
  
  .state{
    font-weight:700;
    font-size:1.05rem;
  }
  
  .pill{
    display:inline-block;
    font-size:.9rem;
    padding:5px 12px;
    border-radius:999px;
    background: rgba(252,181,20,.18);
    border:1px solid rgba(252,181,20,.35);
    color:#ffe9b3;
    font-weight:600;
  }

  /* Panels */
  .panel{
    margin-top:20px;
    background: linear-gradient(180deg, rgba(0,38,84,.72), rgba(0,28,62,.72));
    border: 1px solid rgba(252,181,20,.28);
    border-radius:16px;
    padding:18px 20px;
  }
  
  .panel h3{
    margin:0 0 14px 0;
    font-size:1.15rem;
    color:#ffe9b3;
    border-bottom:1px solid rgba(252,181,20,.2);
    padding-bottom:8px;
  }
  
  .game-summary{
    display:flex;
    flex-direction:column;
    gap:8px;
    font-size:1rem;
  }
  
  .game-summary strong{
    color:var(--sabres-gold);
  }

  /* Goals list */
  .goals{
    display:grid;
    gap:12px;
  }
  
  .goal{
    display:grid;
    grid-template-columns: 90px 1fr;
    gap:14px;
    align-items:start;
    padding:12px 14px;
    border-radius:12px;
    background: rgba(255,255,255,.04);
    border:1px solid rgba(252,181,20,.15);
    transition:all .2s;
  }
  
  .goal:hover{
    background: rgba(252,181,20,.08);
    border-color:rgba(252,181,20,.3);
  }
  
  .time{
    font-weight:700;
    color:#ffe3a3;
    font-size:.95rem;
  }
  
  .goal-details{
    display:flex;
    flex-direction:column;
    gap:4px;
  }
  
  .who{
    font-weight:700;
    color:var(--sabres-white);
  }
  
  .team-name{
    color:var(--sabres-gold);
    font-weight:600;
  }
  
  .assist{
    color:#c6d6f6;
    font-size:.9rem;
  }
  
  .sep{
    opacity:.4;
    padding:0 6px;
  }
  
  .strength{
    color:#a8c5f5;
    font-size:.85rem;
  }

  .loading, .error{
    text-align:center;
    padding:20px;
    color:#c6d6f6;
  }
  
  .error{
    color:#ff9999;
  }

  @media (max-width:768px){
    .teams{
      grid-template-columns: 1fr;
      gap:12px;
    }
    .team{
      justify-content:center !important;
    }
    .score{
      text-align:center;
      font-size:2rem;
    }
    .meta{
      align-items:center;
      min-width:auto;
    }
    .goal{
      grid-template-columns:80px 1fr;
      gap:10px;
    }
  }
  
  @media (max-width:480px){
    .score{font-size:1.8rem}
    .name{font-size:1rem}
    .badge{width:40px; height:40px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- Primary score bar -->
    <div class="scorebar" id="scorebar">
      <div class="teams">
        <div class="team away" id="awayTeam">
          <div class="name">Away</div>
          <div class="badge" id="awayBadge"></div>
        </div>
        <div class="score" id="score">0 — 0</div>
        <div class="team home" id="homeTeam">
          <div class="badge" id="homeBadge"></div>
          <div class="name">Home</div>
        </div>
      </div>
      <div class="meta">
        <div class="state" id="state">Loading…</div>
        <div><span class="pill" id="when"></span></div>
      </div>
    </div>

    <!-- Last Game -->
    <div class="panel" id="lastGamePanel">
      <h3>Last Game</h3>
      <div id="lastGameBox" class="loading">Loading…</div>
    </div>

    <!-- Next Game -->
    <div class="panel" id="nextGamePanel">
      <h3>Next Game</h3>
      <div id="nextGameBox" class="loading">Loading…</div>
    </div>

    <!-- Goals -->
    <div class="panel">
      <h3>Goals</h3>
      <div class="goals" id="goals"><div class="loading">Loading goals…</div></div>
    </div>
  </div>

<script>
(async function(){
  const SABRES_ID = 7;

  // Helper functions
  const setTxt = (id, t) => {
    const el = document.getElementById(id);
    if (el) el.textContent = t;
  };

  const setHTML = (id, html) => {
    const el = document.getElementById(id);
    if (el) el.innerHTML = html;
  };

  function formatDate(dateStr) {
    try {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', {
        weekday: 'short',
        month: 'short',
        day: 'numeric',
        hour: 'numeric',
        minute: '2-digit'
      });
    } catch {
      return dateStr;
    }
  }

  function getTeamLogo(teamId) {
    return `https://assets.nhle.com/logos/nhl/svg/${teamId}_dark.svg`;
  }

  async function fetchJSON(url) {
    try {
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        }
      });
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      return await response.json();
    } catch (error) {
      console.error('Fetch error:', error);
      throw error;
    }
  }

  // Get schedule (previous and next games)
  async function getSchedule() {
    const url = `https://statsapi.web.nhl.com/api/v1/teams/${SABRES_ID}?expand=team.schedule.previous,team.schedule.next`;
    const data = await fetchJSON(url);
    const team = data.teams?.[0];
    
    return {
      previous: team?.previousGameSchedule?.dates?.[0]?.games?.[0] || null,
      next: team?.nextGameSchedule?.dates?.[0]?.games?.[0] || null
    };
  }

  // Get live game data
  async function getGameFeed(gamePk) {
    const url = `https://statsapi.web.nhl.com/api/v1/game/${gamePk}/feed/live`;
    return await fetchJSON(url);
  }

  // Render the main scorebar
  function renderScorebar(game, feed) {
    if (!game) {
      setTxt('state', 'No game data');
      setTxt('when', '—');
      return;
    }

    const away = game.teams.away;
    const home = game.teams.home;
    
    // Update team names
    document.querySelector('#awayTeam .name').textContent = away.team.name;
    document.querySelector('#homeTeam .name').textContent = home.team.name;
    
    // Update logos
    document.getElementById('awayBadge').style.backgroundImage = 
      `url('${getTeamLogo(away.team.id)}')`;
    document.getElementById('homeBadge').style.backgroundImage = 
      `url('${getTeamLogo(home.team.id)}')`;

    // Update scores
    let awayScore = away.score || 0;
    let homeScore = home.score || 0;
    
    if (feed?.liveData?.linescore) {
      const ls = feed.liveData.linescore;
      if (ls.teams?.away?.goals != null) awayScore = ls.teams.away.goals;
      if (ls.teams?.home?.goals != null) homeScore = ls.teams.home.goals;
    }
    
    setTxt('score', `${awayScore} — ${homeScore}`);

    // Update status
    const status = feed?.gameData?.status?.detailedState || 
                   game.status?.detailedState || 
                   'Scheduled';
    setTxt('state', status);

    // Update time/date
    let when = '';
    if (feed?.liveData?.linescore?.currentPeriodTimeRemaining) {
      const ls = feed.liveData.linescore;
      when = `${ls.currentPeriodOrdinal || ''} ${ls.currentPeriodTimeRemaining}`;
    } else if (game.gameDate) {
      when = formatDate(game.gameDate);
    }
    setTxt('when', when || '—');
  }

  // Render goals
  function renderGoals(feed) {
    const goalsEl = document.getElementById('goals');
    
    if (!feed?.liveData?.plays) {
      goalsEl.innerHTML = '<div class="loading">No play data available</div>';
      return;
    }

    const plays = feed.liveData.plays;
    const scoringPlays = plays.scoringPlays || [];

    if (scoringPlays.length === 0) {
      goalsEl.innerHTML = '<div class="loading">No goals scored yet</div>';
      return;
    }

    let html = '';
    for (const idx of scoringPlays) {
      const play = plays.allPlays[idx];
      if (!play) continue;

      const period = play.about?.ordinalNum || '';
      const time = play.about?.periodTime || '';
      const team = play.team?.name || '';
      
      const scorer = play.players?.find(p => p.playerType === 'Scorer');
      const assists = play.players?.filter(p => p.playerType === 'Assist') || [];
      
      const strength = play.result?.strength?.code || 'EV';
      const emptyNet = play.result?.emptyNet ? ', EN' : '';

      html += `
        <div class="goal">
          <div class="time">${period}<br>${time}</div>
          <div class="goal-details">
            <div>
              <span class="team-name">${team}</span>
              <span class="sep">—</span>
              <span class="who">${scorer?.player?.fullName || 'Unknown'}</span>
            </div>
            <div class="strength">(${strength}${emptyNet})</div>
            ${assists.length ? `
              <div class="assist">Assists: ${assists.map(a => a.player.fullName).join(', ')}</div>
            ` : ''}
          </div>
        </div>
      `;
    }

    goalsEl.innerHTML = html;
  }

  // Render last game summary
  function renderLastGame(game) {
    const el = document.getElementById('lastGameBox');
    if (!game) {
      el.innerHTML = '<div class="loading">No previous game data</div>';
      return;
    }

    const away = game.teams.away;
    const home = game.teams.home;
    const when = formatDate(game.gameDate);

    el.innerHTML = `
      <div class="game-summary">
        <div><strong>${away.team.name}</strong> at <strong>${home.team.name}</strong></div>
        <div>Final: ${away.score || 0} — ${home.score || 0}</div>
        <div>${when}</div>
      </div>
    `;
  }

  // Render next game summary
  function renderNextGame(game) {
    const el = document.getElementById('nextGameBox');
    if (!game) {
      el.innerHTML = '<div class="loading">No upcoming game scheduled</div>';
      return;
    }

    const away = game.teams.away;
    const home = game.teams.home;
    const when = formatDate(game.gameDate);

    el.innerHTML = `
      <div class="game-summary">
        <div><strong>${away.team.name}</strong> at <strong>${home.team.name}</strong></div>
        <div>${when}</div>
      </div>
    `;
  }

  // Main execution
  try {
    const schedule = await getSchedule();
    
    // Use previous game as primary display
    const primaryGame = schedule.previous;
    
    if (primaryGame) {
      const feed = await getGameFeed(primaryGame.gamePk);
      renderScorebar(primaryGame, feed);
      renderGoals(feed);
    } else {
      setTxt('state', 'No recent game');
      setTxt('score', '— — —');
      setTxt('when', '—');
    }

    // Render summaries
    renderLastGame(schedule.previous);
    renderNextGame(schedule.next);

  } catch (error) {
    console.error('Error loading data:', error);
    setTxt('state', 'Error loading data');
    setHTML('goals', `<div class="error">Failed to load data: ${error.message}</div>`);
    setHTML('lastGameBox', '<div class="error">—</div>');
    setHTML('nextGameBox', '<div class="error">—</div>');
  }
})();
</script>

</body>
</html>
